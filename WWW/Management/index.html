<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Tree</title>

    	<!-- style + demo .css -->
    	<style>

    			html, body { 
	    			height: 100%; 
	    			width: 100%; 
	    			padding: 0; 
	    			border: 0;
	    			/*overflow: hidden;*/
    			}
				
				#appLayout {
				    height: 100%;
				}
				#leftCol {
				    width: 24em;
				}
				
				.claro .demoLayout .edgePanel {
				   /* background-color: #d0e9fc; */
				}
			
    	</style>
   	<link rel="stylesheet"
    		href="http://ajax.googleapis.com/ajax/libs/dojo/1.7.2/dijit/themes/claro/claro.css"
    		media="screen" />
    	
    	<!--<link rel="stylesheet" href="css/themes/claro/claro.css" media="screen" />-->
    	
    	<!-- isDebug: true -->
  
    	<script src="http://ajax.googleapis.com/ajax/libs/dojo/1.7.2/dojo/dojo.js"
				data-dojo-config="isDebug: true, async: true">
    	</script>
    	
    	 <script>
			
			require(["dojo/ready", "dojo/parser", "dijit/registry", "dijit/layout/BorderContainer", "dijit/layout/TabContainer", "dijit/layout/ContentPane", "dijit/Dialog", "dojo/store/JsonRest", "dojo/store/Observable", "dijit/Tree", "dijit/tree/dndSource", "dojo/query"], 
			function(ready, parser, registry, BorderContainer, TabContainer, ContentPane, Dialog, JsonRest, Observable, Tree, dndSource, query) {
				
				parser.parse();
				
				ready(function(){
				
				workspace = JsonRest({
					//target:"data/",
					//target:"/restxq/ws/ws_produkte/nodej-meta/n/",
					target:"/restxq/ws/ws_bootsmotoren/nodej-meta/n/",
					mayHaveChildren: function(object){
						// see if it has a children property
						return "children" in object
						//return object.child-count > 0
					},
					getChildren: function(object, onComplete, onError){
						// retrieve the full copy of the object
						this.get(object.name).then(function(fullObject){
							// copy to the original object so it has the children array as well.
							object.children = fullObject.children;
							// now that full object, we should have an array of children
							onComplete(fullObject.children);
						}, function(error){
							// an error occurred, log it, and indicate no children
							console.error(error);
							onComplete([]);
						});
					},
					getRoot: function(onItem, onError){
						// get the root object, we will do a get() and callback the result
						//this.get("Motoren").then(onItem, onError);
						this.get("Bootsmotoren").then(onItem, onError);
						
					},
					getLabel: function(object){
						// just get the name
						return object.name;
					},
					
					pasteItem: function(child, oldParent, newParent, bCopy, insertIndex){
						var store = this;
						store.get(oldParent.id).then(function(oldParent){
							store.get(newParent.id).then(function(newParent){
								var oldChildren = oldParent.children;
								dojo.some(oldChildren, function(oldChild, i){
									if(oldChild.id == child.id){
										oldChildren.splice(i, 1);
										return true; // done
									}
								});
								store.put(oldParent);
								newParent.children.splice(insertIndex || 0, 0, child);
								store.put(newParent);
							}, function(error){
								alert("Error occurred (this demo is not hooked up to a real database, so this is expected): " + error);
							});
						});
					},
					put: function(object, options){
						this.onChildrenChange(object, object.children);
						this.onChange(object);
						return JsonRest.prototype.put.apply(this, arguments);
					},
					remove: function(id){
						// We call onDelete to signal to the tree to remove the child. The 
						// remove(id) gets and id, but onDelete expects an object, so we create 
						// a fake object that has an identity matching the id of the object we 
						// are removing.
						this.onDelete({id: id});
						// note that you could alternately wait for this inherited add function to 
						// finish (using .then()) if you don't want the event to fire until it is 
						// confirmed by the server
						return JsonRest.prototype.remove.apply(this, arguments);
					}
				});
				
				tree = new Tree({
					model: workspace,
					dndController: dndSource
				}, "tree"); // make sure you have a target HTML element with this id
				tree.startup();
				
				/*
				query("#add-new-child").on("click", function(){
					var selectedObject = tree.get("selectedItems")[0];
					if(!selectedObject){
						return alert("No object selected");
					}
					workspace.get(selectedObject.id).then(function(selectedObject){
						selectedObject.children.push({
							name: "New child",
							id: Math.random()
						});
						workspace.put(selectedObject);
					});
					
				});
				
				query("#remove").on("click", function(){
					var selectedObject = tree.get("selectedItems")[0];
					if(!selectedObject){
						return alert("No object selected");
					}
					workspace.remove(selectedObject.id);
				});
				
				tree.on("dblclick", function(object){
					object.name = prompt("Enter a new name for the object");
					workspace.put(object);
				}, true);
				*/
				
				tree.on("click", function(object){	
				
				var pane = registry.byId("id_"+object.id);
				
				/*content: "<h4>" + object.name + "</h4>", */
    	 		//content: '<iframe src="/restxq/xforms/grid-edit/ws_produkte/'+object.name+'" width="100%" height="100%"></iframe>',
				if(pane == undefined){
					pane = new ContentPane({
						id: "id_"+object.id,
						title: object.name,
						content: "<h4>" + object.name + "</h4>",
    	 	  			closable: true,
            			onClose: function(){
               				// confirm() returns true or false, so return that.
               				return confirm("Do you really want to Close this?");
           					 }
						/*href: "/restxq/xforms/grid-edit/ws_produkte/Powermotor" */
						
					});
					registry.byId("contentTabs").addChild(pane);
					}else {
					 registry.byId("contentTabs").selectChild(pane);
					}
					
					}, true);	
					
						/*scope ? */
				showDialog = function() {
					registry.byId("propDialog").show();
				}
				// Hide the dialog
				hideDialog = function() {
					registry.byId("PropDialog").hide();
				}
			
				
			}); /* end ready() */
		}); 
		
	
    	 </script>
    	<!--<script>
    		//need to destroy widgets after removing
    		destroyRecursive();
    		
    		//watch tab changes
    		myTabContainer.watch("selectedChildWidget", function(name, oval, nval){
    			console.log("selected child changed from ", oval, " to ", nval);
			});
    	</script>-->
    </head>
    <body class="claro">
    	<div id="appLayout" class="demoLayout" data-dojo-type="dijit.layout.BorderContainer" data-dojo-props="design: 'headline'">
    		<div id="contentTabs" class="centerPanel" data-dojo-type="dijit.layout.TabContainer" data-dojo-props="region: 'center', tabPosition: 'bottom'">
    			
    		<!--	<div data-dojo-type="dijit.layout.ContentPane" title="Group 1">
    				<h4>Group 1 Content</h4>
    				<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
    			</div>
    			<div data-dojo-type="dijit.layout.ContentPane" title="Group Two">
    				<h4>Group 2 Content</h4>
    				</div>-->
    			
    			
    			<!--<div data-dojo-type="dijit.layout.ContentPane" title="Test Panel">
    				<h4>Dialog Test</h4>
    				
    				<div class="dijitHidden">
    					<!-\- dialog that gets its content via ajax, uses loading message -\->
    					<div data-dojo-type="dijit.Dialog" style="width:600px;" id="propDialog">
    						<!-\-<p>some content</p>-\->
    					<!-\-	<iframe src="http://localhost:8984/restxq/xforms/edit/ws_produkte/Powermotor/dimensions" width="100%" height="100%"></iframe>-\->
    						<!-\-
    						<iframe src="/restxq/xforms/edit-slot/ws_produkte/2ee57faa-bde5-49a4-81ef-aa1b30a9e637" width="100%" height="100%"></iframe>
    						-\->
    					</div>
    				</div>
    				
    				<table style="border: solid 1px grey;">
    					<thead>
    						<th>
    							Merkmal
    						</th>
    						<th>
    							Wert
    						</th>
    					</thead>
    					<tbody>
    						<tr>
    							<td>Bezeichnung</td>
    							<td onclick="showDialog();">XYZ Lorem Ipsum</td>
    						</tr>
    						<tr>
    							<td>Farbe</td>
    							<td onclick="showDialog();">blau</td>
    						</tr>
    					</tbody>
    					
    				</table>
    	</div> <!-\- end Test Panel -\->-->
    	
    			
    		</div>
    		<div class="edgePanel" data-dojo-type="dijit.layout.ContentPane" data-dojo-props="region: 'top'">Header content (top)</div>
    		<div id="leftCol" class="edgePanel" data-dojo-type="dijit.layout.ContentPane" data-dojo-props="region: 'left', splitter: true">
    			
    			<div id="tree"></div>
    			<!-- <p>
    				<button id="add-new-child">Add new child to selected item</button>
    			</p>
    			<p>
    				<button id="remove">Remove selected item</button>
    			</p> -->
    		</div>
    	</div>
      
       
    </body>
</html>
