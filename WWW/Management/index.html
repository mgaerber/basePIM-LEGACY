<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Tree</title>

    	<!-- style + demo .css -->
    	<style>
    			/*start demo.css */
				* {
				    outline: none !important;
				}
				
				body {
				    margin: 0;
				    padding: 2em;
				    font-family: Lucida Sans,Lucida Grande,Arial !important;
				    font-size: 13px !important;
				    background: white;
				    color: #333;
				}
				
				button {
					-webkit-transition: background-color 0.2s linear;
					border-radius:4px;
					-moz-border-radius: 4px 4px 4px 4px;
					-moz-box-shadow: 0 1px 1px rgba(0, 0, 0, 0.15);
					background-color: #E4F2FF;
					background-image: url("http://ajax.googleapis.com/ajax/libs/dojo/1.7.1/dijit/themes/claro/form/images/button.png");
					background-position: center top;
					background-repeat: repeat-x;
					border: 1px solid #769DC0;
					padding: 2px 8px 4px;
					font-size:1em;
				}
				
				button:hover {
					background-color: #AFD9FF;
					color: #000000;
				}
				
				h1 {
					font-size:1.5em;
				}
				
    			/* Any demo specific styling needed for this tutorial only */
				html, body {
				    height: 100%;
				    margin: 0;
				    overflow: hidden;
				    padding: 0;
				}
				
				#appLayout {
				    height: 100%;
				}
				#leftCol {
				    width: 24em;
				}
				
				.claro .demoLayout .edgePanel {
				    background-color: #d0e9fc;
				}
				
				#viewsChart {
					width: 550px;
					height: 550px;
				}
				
			
			
    	</style>
    	<link rel="stylesheet"
    		href="http://ajax.googleapis.com/ajax/libs/dojo/1.7.1/dijit/themes/claro/claro.css"
    		media="screen" />
    	<!-- isDebug: true -->
    	<!-- -->
    	<script src="http://ajax.googleapis.com/ajax/libs/dojo/1.7.1/dojo/dojo.js"
				data-dojo-config="isDebug: true, async: true">
		</script>
    	
    	<!--<script>
    			require(["dojo/on", "dojo/dom", "dijit/registry", "dijit/layout/BorderContainer", "dijit/layout/TabContainer", "dijit/layout/ContentPane", "dojo/domReady!"],
			function(on, dom, registry, BorderContainer, TabContainer, ContentPane){
				function addTab(name) {
				var pane = new ContentPane({
					title: name,
					content: "<h4>" + name + "</h4>"
				});
				registry.byId("contentTabs").addChild(pane);
			}

				// create the BorderContainer and attach it to our appLayout div
				var appLayout = new BorderContainer({
					design: "headline"
				}, "appLayout");


				// create the TabContainer
				var contentTabs = new TabContainer({
					region: "center",
					id: "contentTabs",
					tabPosition: "bottom",
					"class": "centerPanel",
					href: "contentCenter.html"
				})

				// add the TabContainer as a child of the BorderContainer
				appLayout.addChild( contentTabs );

				// create and add the BorderContainer edge regions
				appLayout.addChild(
					new ContentPane({
						region: "top",
						"class": "edgePanel",
						content: "Header content (top)"
					})
				)
				appLayout.addChild(
					new ContentPane({
						region: "left",
						id: "leftCol", "class": "edgePanel",
						content: "Sidebar content (left)",
						splitter: true
					})
				);

				// Add initial content to the TabContainer
				contentTabs.addChild(
					new ContentPane({
						title: "Start"
					}, "startContent")
				);

				var tabCounter = 1;
				on(dom.byId("createTabBtn"), "click", function(evt){
					addTab("Tab " + (++tabCounter));
				});

				// start up and do layout
				appLayout.startup();
			});
    	</script>-->
    	 <script>
			
			require(["dojo/ready", "dojo/parser", "dijit/registry", "dijit/layout/BorderContainer", "dijit/layout/TabContainer", "dijit/layout/ContentPane", "dojo/store/JsonRest", "dojo/store/Observable", "dijit/Tree", "dijit/tree/dndSource", "dojo/query"], 
			function(ready, parser, registry, BorderContainer, TabContainer, ContentPane, JsonRest, Observable, Tree, dndSource, query) {
				
				parser.parse();
				
				ready(function(){
				
				workspace = JsonRest({
					//target:"data/",
					target:"/restxq/ws/ws_produkte/nodej-meta/n/",
					mayHaveChildren: function(object){
						// see if it has a children property
						return "children" in object
						//return object.child-count > 0
					},
					getChildren: function(object, onComplete, onError){
						// retrieve the full copy of the object
						this.get(object.name).then(function(fullObject){
							// copy to the original object so it has the children array as well.
							object.children = fullObject.children;
							// now that full object, we should have an array of children
							onComplete(fullObject.children);
						}, function(error){
							// an error occurred, log it, and indicate no children
							console.error(error);
							onComplete([]);
						});
					},
					getRoot: function(onItem, onError){
						// get the root object, we will do a get() and callback the result
						this.get("Motoren").then(onItem, onError);
					},
					getLabel: function(object){
						// just get the name
						return object.name;
					},
					
					pasteItem: function(child, oldParent, newParent, bCopy, insertIndex){
						var store = this;
						store.get(oldParent.id).then(function(oldParent){
							store.get(newParent.id).then(function(newParent){
								var oldChildren = oldParent.children;
								dojo.some(oldChildren, function(oldChild, i){
									if(oldChild.id == child.id){
										oldChildren.splice(i, 1);
										return true; // done
									}
								});
								store.put(oldParent);
								newParent.children.splice(insertIndex || 0, 0, child);
								store.put(newParent);
							}, function(error){
								alert("Error occurred (this demo is not hooked up to a real database, so this is expected): " + error);
							});
						});
					},
					put: function(object, options){
						this.onChildrenChange(object, object.children);
						this.onChange(object);
						return JsonRest.prototype.put.apply(this, arguments);
					},
					remove: function(id){
						// We call onDelete to signal to the tree to remove the child. The 
						// remove(id) gets and id, but onDelete expects an object, so we create 
						// a fake object that has an identity matching the id of the object we 
						// are removing.
						this.onDelete({id: id});
						// note that you could alternately wait for this inherited add function to 
						// finish (using .then()) if you don't want the event to fire until it is 
						// confirmed by the server
						return JsonRest.prototype.remove.apply(this, arguments);
					}
				});
				tree = new Tree({
					model: workspace,
					dndController: dndSource
				}, "tree"); // make sure you have a target HTML element with this id
				tree.startup();
				
				/*
				query("#add-new-child").on("click", function(){
					var selectedObject = tree.get("selectedItems")[0];
					if(!selectedObject){
						return alert("No object selected");
					}
					workspace.get(selectedObject.id).then(function(selectedObject){
						selectedObject.children.push({
							name: "New child",
							id: Math.random()
						});
						workspace.put(selectedObject);
					});
					
				});
				
				query("#remove").on("click", function(){
					var selectedObject = tree.get("selectedItems")[0];
					if(!selectedObject){
						return alert("No object selected");
					}
					workspace.remove(selectedObject.id);
				});
				
				tree.on("dblclick", function(object){
					object.name = prompt("Enter a new name for the object");
					workspace.put(object);
				}, true);
				*/
				
				tree.on("click", function(object){	
				
				var pane = registry.byId("id_"+object.id);
				
				if(pane == undefined){
					pane = new ContentPane({
						id: "id_"+object.id,
						title: object.name,
						content: "<h4>" + object.name + "</h4>"
					});
					registry.byId("contentTabs").addChild(pane);
					}else {
					 registry.byId("contentTabs").selectChild(pane);
					}
					
					}, true);		
				
			}); /* end ready() */
		}); 
		</script>
    </head>
    <body class="claro">
    	<div id="appLayout" class="demoLayout" data-dojo-type="dijit.layout.BorderContainer" data-dojo-props="design: 'headline'">
    		<div id="contentTabs" class="centerPanel" data-dojo-type="dijit.layout.TabContainer" data-dojo-props="region: 'center', tabPosition: 'bottom'">
    			
    		<!--	<div data-dojo-type="dijit.layout.ContentPane" title="Group 1">
    				<h4>Group 1 Content</h4>
    				<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
    			</div>
    			<div data-dojo-type="dijit.layout.ContentPane" title="Group Two">
    				<h4>Group 2 Content</h4>
    			</div>
    			<div data-dojo-type="dijit.layout.ContentPane" title="Long Tab Label for this One">
    				<h4>Group 3 Content</h4>
    			</div>
    			-->
    			
    		</div>
    		<div class="edgePanel" data-dojo-type="dijit.layout.ContentPane" data-dojo-props="region: 'top'">Header content (top)</div>
    		<div id="leftCol" class="edgePanel" data-dojo-type="dijit.layout.ContentPane" data-dojo-props="region: 'left', splitter: true">
    			<div id="tree"></div>
    			<!-- <p>
    				<button id="add-new-child">Add new child to selected item</button>
    			</p>
    			<p>
    				<button id="remove">Remove selected item</button>
    			</p> -->
    		</div>
    	</div>
      
       
    </body>
</html>
